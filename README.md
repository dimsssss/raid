<p align="center">
    <h1 align="center">
        Raid Ranking API
    </h1>
    <p align="center">ë³´ìŠ¤ ë ˆì´ë“œ ë­í‚¹ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ëŠ” APIì…ë‹ˆë‹¤<a href="https://github.com/dimsssss/raid"></a>.</p>
</p>

<p align="center">
    <a href="">
        <img alt="license" src="https://img.shields.io/github/license/dimsssss/toy-intergration-test">
    </a>
    <a href="">
        <img alt="npm" src="https://img.shields.io/node/v-lts/npm?label=npm&logo=npm">
    </a>
    <a href="https://expressjs.com/">
        <img alt="express" src="https://img.shields.io/node/v-lts/express?label=express&logo=express">
    </a>
    <a href="https://jestjs.io/">
        <img alt="jest" src="https://img.shields.io/node/v-lts/express?label=jest&logo=jest">
    </a>
    <a href="https://sequelize.org/">
        <img alt="sequelize" src="https://img.shields.io/node/v-lts/sequelize?label=sequelize&logo=sequelize">
    </a>
    <a href="https://dl.circleci.com/status-badge/redirect/gh/dimsssss/raid/tree/main">
        <img alt="circleci" src="https://dl.circleci.com/status-badge/img/gh/dimsssss/raid/tree/main.svg?style=svg">
    </a>
</p>

## ğŸ— í”„ë¡œì íŠ¸ ì„¤ëª…

ë³´ìŠ¤ ë ˆì´ë“œì™€ ê´€ë ¨ëœ APIë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ ì…ë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•ìœ¼ë¡œëŠ” ë‹¤ìŒì´ ìˆìŠµë‹ˆë‹¤.

- í•œë²ˆì— í•œ ëª…ì˜ ìœ ì €ë§Œ ë³´ìŠ¤ë ˆì´ë“œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì•„ë¬´ë„ ë³´ìŠ¤ë ˆì´ë“œë¥¼ ì‹œì‘í•œ ê¸°ë¡ì´ ì—†ë‹¤ë©´ ì‹œì‘ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ì‹œì‘í•œ ê¸°ë¡ì´ ìˆë‹¤ë©´ ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹œì‘í•œ ìœ ì €ê°€ ë³´ìŠ¤ë ˆì´ë“œë¥¼ ì¢…ë£Œí–ˆê±°ë‚˜, ì‹œì‘í•œ ì‹œê°„ìœ¼ë¡œë¶€í„° ë ˆì´ë“œ ì œí•œì‹œê°„ë§Œí¼ ê²½ê³¼ë˜ì—ˆì–´ì•¼ í•©ë‹ˆë‹¤.

## ìºì‹œ ì ìš©

ë³´ìŠ¤ ë ˆì´ë“œë¥¼ ì„±ê³µí•˜ë©´ ë ˆì´ë“œ ë ˆë²¨ì— ë§ëŠ” ì ìˆ˜ë¥¼ ì–»ëŠ”ë‹¤. ë­í‚¹ APIëŠ” ìœ ì € ë³„ ë ˆì´ë“œ ì ìˆ˜ì˜ ì´í•©ìœ¼ë¡œ ìˆœìœ„ë¥¼ ì •í•œë‹¤. ìš”êµ¬ì‚¬í•­ì„ ë³´ë©´ ë³´ìŠ¤ë¥¼ ë ˆì´ë“œ í•˜ëŠ” ì‹œê°„ì€ 3ë¶„ë§Œ í—ˆìš©í•œë‹¤. 3ë¶„ë§ˆë‹¤ í•œë²ˆì”©ë§Œ ì‹œë„í•  ìˆ˜ ìˆê³  ë ˆì´ë“œë¥¼ ì„±ê³µí•´ì•¼ ë­í‚¹ì´ ë³€ê²½ëœë‹¤. **rankingì´ ë³€ë™ë˜ëŠ” ê²½ìš°ë³´ë‹¤ í˜„ì¬ rankigì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…ì´ ë” ë§ì„ê±°ë¼ ì˜ˆìƒì„ í–ˆë‹¤**.

ë­í‚¹ì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ sumì„ ì´ìš©í•´ì„œ êµ¬í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ê°€ ë§ì•„ì§ˆìˆ˜ë¡ êµ¬í•˜ëŠ” ì‹œê°„ì´ ì˜¤ë˜ê±¸ë¦°ë‹¤. ë³€ë™ì€ ìì£¼ ì—†ìœ¼ë©° êµ¬í•˜ëŠ”ë° ì‹œê°„ì€ ì˜¤ë˜ ê±¸ë¦¬ê³  ìì£¼ ìš”ì²­ë˜ëŠ” ìƒí™©, ìºì‹œë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ì€ ìƒí™©ì´ë‹¤.

### Redis

ë­í‚¹ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ìºì‹±ì„ í•˜ë‹¤ê°€ ì„œë²„ê°€ ì£½ì–´ë²„ë¦¬ë©´ ìºì‹±ì´ ë¬´íš¨í™”ëœë‹¤. ì„œë²„ì— ì¢Œì§€ìš°ì§€ ë˜ëŠ” ìƒí™©ì´ì–´ì„œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì•ˆì •ì ì´ë‹¤

in-memory ì €ì¥ì†Œ ê¸°ìˆ  ê°€ìš´ë° redisë¥¼ ì„ íƒí•˜ì˜€ëŠ”ë° ì´ìœ ëŠ” ì‚¬ìš©ìê°€ ë§ì•„ì„œì´ë‹¤. â€˜ì‚¬ìš©ìê°€ ë§ë‹¤â€™ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë‹¤ë¥¸ ê¸°ìˆ ë³´ë‹¤ ì•ˆì „ì´ ë³´ì¥ë˜ê³  ìë£Œê°€ í’ë¶€í•˜ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì„œë¹„ìŠ¤ ìš´ì˜ì¤‘ì— ê°€ì¥ ì•ˆì¢‹ê²Œ ìƒê°í•˜ëŠ” ê²½ìš°ëŠ” ì‚¬ìš©í•˜ëŠ” ê¸°ìˆ ì´ ê¸°ìˆ  ì§€ì›ì´ ëŠê¸°ê±°ë‚˜ ì˜¤í”ˆ ì†ŒìŠ¤ë¼ë©´ ì»¤ë®¤ë‹ˆí‹° í™œë™ì´ ì €ì¡°í•˜ê³  ìë£Œê°€ ì—†ëŠ” ê²ƒì„ ê°€ì¥ ì•ˆì¢‹ê²Œ ìƒê°í•œë‹¤.

memcachedë„ ë§ì´ ì‚¬ìš©í•˜ì§€ë§Œ ë‚´ ê¸°ì¤€ì—ëŠ” redisê°€ ë” ì¢‹ì•˜ë‹¤. ë‘˜ì˜ ì°¨ì´ëŠ” ì•„ë˜ ê¸€ì— ë‚˜ì™€ìˆë‹¤

[Redis vs. Memcached | AWS](https://aws.amazon.com/ko/elasticache/redis-vs-memcached/)

## Sequelize ì•„ì‰¬ìš´ ì 

row_numberë¼ëŠ” mysql í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•˜ëŠ”ë° ë‚´ê°€ ì˜ë„í•œ sqlë¬¸ìœ¼ë¡œ ë³€í™˜ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤.

```jsx
// fn('mysql í•¨ìˆ˜ ì´ë¦„', 'í•¨ìˆ˜ì— ì ìš©ë  ì»¬ëŸ¼ ì´ë¦„')
Sequelize.fn(`ROW_NUMBER() OVER`, Sequelize.col('ORDER BY totalScore')),
```

ìœ„ì™€ ê°™ì´ ORDER BY í‚¤ì›Œë“œê°€ ê°™ì´ ë“¤ì–´ê°€ì•¼ í•˜ëŠ” ê²½ìš°ì— sql syntax ì—ëŸ¬ë¥¼ ë‚´ë¿œëŠ”ë‹¤. ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì„œ í•´ê²°í•˜ì˜€ë‹¤

ë˜ í•˜ë‚˜ì˜ ì•„ì‰¬ìš´ì ì€ ê³µì‹ë¬¸ì„œê°€ ì •í™•í•˜ì§€ ì•Šë‹¤. ë™ì‹œì„± ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ê³µì‹ ë¬¸ì„œ ë‚´ìš©ëŒ€ë¡œ optimistic lockì„ ì„¤ì •í–ˆì§€ë§Œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. ì§ì ‘ lockì„ ê±¸ì–´ì„œ í•´ê²°í•´ì•¼í–ˆë‹¤

## ê±°ì˜ ë™ì‹œì— ì—¬ëŸ¬ ê°œì˜ ìš”ì²­ì´ ì™”ì„ ë•Œ

ìš”êµ¬ ì‚¬í•­ìœ¼ë¡œ ì˜¤ì§ í•œëª…ë§Œ ë³´ìŠ¤ ë ˆì´ë“œë¥¼ ì‹œì‘í•  ìˆ˜ ìˆê³  3ë¶„ ë™ì•ˆ ëˆ„êµ¬ë„ ë ˆì´ë“œë¥¼ ì§„í–‰í•  ìˆ˜ ì—†ë‹¤. ë³´ìŠ¤ ë ˆì´ë“œ ì´ë²¤íŠ¸ê°€ ì‹œì‘ë˜ë©´ **ë™ì‹œì— ì—¬ëŸ¬ ê°œì˜ ìš”ì²­ì´ í•œêº¼ë²ˆì— ì˜¬ ìˆ˜ ìˆëŠ” ìƒí™©**ì´ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.

## ë‚™ê´€ì  ë½

ë‹¤ì–‘í•œ í”„ë ˆì„ì›Œí¬ê°€ ì´ë¥¼ ì§€ì›í•˜ëŠ”ë° version ê°’ì„ ë‘ì–´ì„œ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹í•  ë•Œ versionì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì•„ë‹Œì§€ë¥¼ í™•ì¸í›„ ì‹œì‘í•  ë•Œ versionì´ ê·¸ëŒ€ë¡œë¼ë©´(ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šì•˜ë‹¤ë©´) íŠ¸ëœì­ì…˜ì€ ì»¤ë°‹ì„ í•˜ê³  ê·¸ë ‡ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¡¤ë°±ì„ í•œë‹¤.

https://product.kyobobook.co.kr/detail/S000001766328

ë‚™ê´€ì ë½ìœ¼ë¡œ í•´ê²°í•˜ë ¤ê³  í–ˆì§€ë§Œ ìƒí™©ì´ ì—¬ì˜ì¹˜ ì•Šì•˜ë‹¤. ì‚¬ìš©í•˜ëŠ” ORM ê³µì‹ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ”ë°ë¡œ versionì„ ì„¤ì •í–ˆì§€ë§Œ ì„¤ëª…ëŒ€ë¡œ íŠ¹ì • ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆë‹¤.

https://sequelize.org/docs/v6/other-topics/optimistic-locking/

### ë½ ë³´ê´€ ì—­í• ì„ í•˜ëŠ” í…Œì´ë¸” ì¶”ê°€

ì ê¸ˆì„ ì–»ê¸° ìœ„í•œ í…Œì´ë¸”ì„ ì¶”ê°€í•˜ì˜€ë‹¤. ì ê¸ˆì— ëŒ€í•œ rowë¥¼ ìƒì„±í•˜ê³  rowì˜ íŠ¹ì • ì»¬ëŸ¼ì´ falseì´ë©´ ë ˆì´ë“œ ë¡œê·¸ í…Œì´ë¸”ì— í–‰ì„ ì‚½ì…í•œë‹¤. ì´ ë°©ë²•ìœ¼ë¡œ ë™ì‹œì„±ì„ í•´ê²°í•˜ì˜€ëŠ”ë° ë‹¨ì ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë¸ ë¶€ë¶„ì˜ ì½”ë“œê°€ ì§€ì €ë¶„í•´ì§„ë‹¤. ë™ì‹œì„±ì„ ì œì–´í•˜ê¸° ìœ„í•œ ì½”ë“œê°€ ëª¨ë¸ ì½”ë“œì— ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì´ë‹¤.

## ë¶€í•˜í…ŒìŠ¤íŠ¸

ìš”êµ¬ ì¡°ê±´ ê°€ìš´ë° í•˜ë‚˜ëŠ” í•œë²ˆì— í•œëª…ë§Œ ë³´ìŠ¤ ë ˆì´ë“œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. **ì´ í…ŒìŠ¤íŠ¸ì˜ ëª©ì ì€ ë™ì‹œì— ìš”ì²­ì´ ë“¤ì–´ì™€ë„ í•˜ë‚˜ë§Œ ì •ìƒ ì²˜ë¦¬ë¥¼ í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤**

### ê²°ê³¼

![ë™ì‹œ ì‚¬ìš©ì 100ëª…ìœ¼ë¡œ ë¶€í•˜í…ŒìŠ¤íŠ¸](./image/2022-09-21-10-56-53.png)

ë™ì‹œ ì‚¬ìš©ì 100ëª…ìœ¼ë¡œ ë¶€í•˜í…ŒìŠ¤íŠ¸

![ë™ì‹œ ì‚¬ìš©ì 1000ëª…ìœ¼ë¡œ ë¶€í•˜í…ŒìŠ¤íŠ¸](./image/2022-09-21-17-26-43.png)

ë™ì‹œ ì‚¬ìš©ì 1000ëª…ìœ¼ë¡œ ë¶€í•˜í…ŒìŠ¤íŠ¸

### ë” ìƒê°í•´ë³¼ ë¶€ë¶„

í•œëª…ì´ ë ˆì´ë“œë¥¼ ì‹œì‘í•˜ë©´ 3ë¶„ ë™ì•ˆ ë“¤ì–´ì˜¤ëŠ” ê°™ì€ ìš”ì²­ì„ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ë‹¤. ë˜‘ê°™ì€ ê²°ê³¼ì¸ë° ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•  í•„ìš”ëŠ” ì—†ë‹¤. ì›¹ ì„œë²„ì— bossStateë¼ëŠ” ê°ì²´ì— ì…ì¥ ê°€ëŠ¥ì—¬ë¶€ë¥¼ ìºì‹±í•´ ë†“ê³  ê°™ì€ APIê°€ ë“¤ì–´ì˜¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ ëŒ€ì‹  ë°”ë¡œ ì…ì¥ë¶ˆê°€ ì‘ë‹µì„ ë³´ëƒˆë‹¤

![ìŠ¤í¬ë¦°ìƒ· 2022-09-21 17-30-23.png](./image/2022-09-21-17-30-23.png)

## ë¹„ë™ê¸° ì‘ì—… íƒ€ì´ë° ë§ì¶”ê¸°

ë³´ìŠ¤ ë ˆì´ë“œ ë„ì¤‘ì— ì„œë²„ê°€ ì£½ì—ˆë‹¤ê°€ ë‹¤ì‹œ ì‹œì‘ë˜ë©´ ì–´ë–¤ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆì„ê¹Œ? non-blcokingìœ¼ë¡œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ìºì‹±ì„ ë‹¤ì‹œ ë³µêµ¬í•˜ê¸° ì „ì— ë³´ìŠ¤ ë ˆì´ë“œ APIê°€ ì‹œì‘ë  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ë§‰ê¸° ìœ„í•´ì„œ ìºì‹±ì„ ë³µêµ¬í•˜ê³  ì„œë²„ì˜ í¬íŠ¸ë¥¼ ì—°ê²°í•˜ê²Œ í•˜ê³  ì‹¶ë‹¤. ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ë©´ì„œ ìˆœì„œë¥¼ ìœ ì§€í•˜ê³  ì‹¶ë‹¤

nodejs ë¹„ë™ê¸° ì²˜ë¦¬ ê¸°ëŠ¥ì„ ìƒê°í•´ë³´ë‹¤ê°€ Promise.all ë©”ì„œë“œê°€ ìƒê°ë‚¬ë‹¤. promise ë°°ì—´ì„ ì¸ìë¡œ ë°›ê³  ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ê°€ ì‹¤í–‰ì´ ëë‚˜ë©´ callbackìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. ë§Œì•½ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•œë‹¤ë©´ rejectë¡œ ì²˜ë¦¬í•œë‹¤.

```jsx
Promise.all([externalAPIPromise, redisInitPromise]).then(async result => {
  const [bossState, redis] = result
  const bossRaidCache = {}
  await bossStateAPI.setBossStateTo(bossRaidCache, bossState, redis)

  const port = createServer(app)
  app.set('port', port)
  app.set('bossRaidCache', bossRaidCache)
})
```

## ğŸŒ API Document

https://app.swaggerhub.com/apis-docs/dimsssss/raid-api/1.0.0

## ğŸ§¾ ì‹¤í–‰

```shell
npm run dev
```
